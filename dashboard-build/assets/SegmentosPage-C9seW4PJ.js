import{j as e,m as E}from"./motion-CnUDAaLS.js";import{r as l}from"./react-vendor-DDxOQdDP.js";import{u as Q,s as N}from"./index-DNvzsDZk.js";import{F as U}from"./FAB-0kAuwrai.js";import{u as V}from"./useAlertModal-Den3me5c.js";import{L as W}from"./LoadingSpinner-QA4ydWnx.js";import"./export-Dlusqx8k.js";import"./supabase-BCnEU3Yj.js";import"./analytics-BMD6QFpy.js";function X({segmento:s,index:b,onClick:p}){const i=s.marcas_relacionadas?.length||0,h=s.leadsCount??s.leads?.length??0;return e.jsxs(E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:b*.05},whileHover:{scale:1.02,y:-4},onClick:p,className:`
        bg-[#0F172A]
        border border-white/5
        rounded-3xl
        p-6 lg:p-8
        cursor-pointer
        transition-all
        hover:border-[#10B981]/30
        hover:shadow-xl
        hover:shadow-[#10B981]/10
        relative
        overflow-hidden
      `,children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-orange-500/5 to-transparent opacity-0 hover:opacity-100 transition-opacity pointer-events-none"}),e.jsxs("div",{className:"flex items-start justify-between mb-6 relative z-10",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1",children:[s.emoji&&e.jsx("div",{className:"text-4xl lg:text-5xl",children:s.emoji}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"text-xl lg:text-2xl font-bold text-white mb-1",children:s.nome}),e.jsxs("p",{className:"text-xs text-gray-600 font-mono truncate",children:["ID: ",s.id.substring(0,8),"..."]})]})]}),e.jsxs("div",{className:`
          bg-orange-500/10
          border border-orange-500/30
          rounded-xl
          px-3 py-1.5
          flex items-center gap-2
          flex-shrink-0
          ml-2
        `,children:[e.jsx("span",{className:"text-lg",children:"ðŸŽ¯"}),e.jsx("span",{className:"text-sm lg:text-base font-black text-orange-500",children:h})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 mb-6 relative z-10",children:[e.jsxs("div",{className:"bg-white/5 rounded-xl p-3 border border-white/5",children:[e.jsx("div",{className:"text-xs text-gray-500 font-semibold mb-1",children:"Marcas"}),e.jsx("div",{className:"text-xl font-black text-white",children:i})]}),e.jsxs("div",{className:"bg-white/5 rounded-xl p-3 border border-white/5",children:[e.jsx("div",{className:"text-xs text-gray-500 font-semibold mb-1",children:"Leads"}),e.jsx("div",{className:"text-xl font-black text-[#10B981]",children:h})]})]}),s.marcas_relacionadas&&s.marcas_relacionadas.length>0&&e.jsxs("div",{className:"mb-6 relative z-10",children:[e.jsx("div",{className:"text-xs text-gray-500 font-semibold mb-2",children:"Marcas vinculadas:"}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[s.marcas_relacionadas.slice(0,3).map(x=>e.jsxs("div",{className:`
                  bg-white/5
                  border border-white/10
                  rounded-lg
                  px-3 py-1
                  text-xs
                  text-gray-400
                  font-semibold
                  flex items-center gap-1
                `,children:[x.emoji&&e.jsx("span",{children:x.emoji}),x.nome]},x.id)),s.marcas_relacionadas.length>3&&e.jsxs("div",{className:`
                bg-white/5
                border border-white/10
                rounded-lg
                px-3 py-1
                text-xs
                text-gray-500
                font-bold
              `,children:["+",s.marcas_relacionadas.length-3]})]})]}),e.jsxs("div",{className:"flex items-center justify-between pt-4 border-t border-white/5 relative z-10",children:[e.jsxs("span",{className:"text-xs text-gray-600 font-semibold",children:["Criado em ",new Date(s.created_at).toLocaleDateString("pt-BR")]}),e.jsx(E.button,{whileHover:{x:4},className:"text-orange-500 text-sm font-bold flex items-center gap-1",children:"Editar â†’"})]})]})}const Y=["ðŸ§º","ðŸ”","â˜•","ðŸ“š","ðŸ¥","ðŸ‹ï¸","ðŸ’¼","ðŸª","ðŸŽ“","ðŸš—","ðŸ’‡","ðŸ ","ðŸ•","ðŸ¢","ðŸŽ¨","ðŸŽ­","ðŸŽ®","ðŸŽª","ðŸŽ¬","ðŸŽ¤","âš½","ðŸŽ¯","ðŸŽ²","ðŸŽ°","ðŸ›ï¸","ðŸ’…","ðŸ§˜","ðŸ°","ðŸº","ðŸ¨","ðŸ¾","ðŸ’Š","ðŸ”§","âœˆï¸","ðŸ–ï¸","ðŸŽ¹","ðŸ“·","ðŸŒ¿","ðŸ§ª","âš¡"];function ee({segmento:s,onClose:b,onSave:p,isSaving:i}){const[h,x]=l.useState(""),[n,m]=l.useState({nome:"",emoji:"ðŸ¢",descricao:""});l.useEffect(()=>{s&&m({nome:s.nome||"",emoji:s.emoji||"ðŸ¢",descricao:s.descricao||""})},[s]);const u=async()=>{if(!n.nome.trim()){x("O nome do segmento Ã© obrigatÃ³rio.");return}x("");try{await p({...s?.id&&{id:s.id},nome:n.nome.trim(),emoji:n.emoji,descricao:n.descricao.trim()})}catch(r){console.error("Erro ao salvar segmento:",r),x("Erro ao salvar: "+r.message)}};return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm z-50",onClick:b}),e.jsx("div",{className:"fixed inset-0 z-50 flex items-end lg:items-center lg:justify-center p-0 lg:p-4",children:e.jsxs("div",{className:"bg-[#0F172A] border-t lg:border border-[#1F2937] rounded-t-3xl lg:rounded-2xl w-full lg:max-w-xl max-h-[90vh] overflow-hidden flex flex-col",onClick:r=>r.stopPropagation(),children:[e.jsxs("div",{className:"flex-shrink-0 p-6 border-b border-[#1F2937]",children:[e.jsx("div",{className:"w-12 h-1 bg-[#1E293B] rounded-full mx-auto mb-4 lg:hidden"}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-xl font-semibold text-white",children:s?"Editar Segmento":"Novo Segmento"}),e.jsx("button",{onClick:b,className:"w-10 h-10 rounded-xl bg-[#1F2937] border border-[#1E293B] flex items-center justify-center text-[#6a6a6f] hover:text-white transition-colors",children:"âœ•"})]})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-6 space-y-5",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-[10px] text-[#4a4a4f] uppercase tracking-wider mb-2",children:"Nome do Segmento *"}),e.jsx("input",{type:"text",value:n.nome,onChange:r=>m({...n,nome:r.target.value}),placeholder:"Ex: Lavanderias",disabled:i,className:"w-full bg-[#1F2937] border border-[#1E293B] rounded-xl px-4 py-3 text-white placeholder:text-[#4a4a4f] focus:outline-none focus:border-[#10B981]/50 disabled:opacity-50"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-[10px] text-[#4a4a4f] uppercase tracking-wider mb-2",children:"Escolha um Emoji"}),e.jsx("div",{className:"bg-[#1F2937] border border-[#1E293B] rounded-xl p-4 max-h-60 overflow-y-auto",children:e.jsx("div",{className:"grid grid-cols-8 gap-2",children:Y.map(r=>e.jsx("button",{type:"button",onClick:()=>m({...n,emoji:r}),disabled:i,className:`w-10 h-10 rounded-lg flex items-center justify-center text-2xl transition-all hover:scale-110 disabled:opacity-50 disabled:cursor-not-allowed ${n.emoji===r?"bg-[#10B981]/20 border-2 border-[#10B981] scale-110":"bg-[#0B1220] border border-[#1E293B] hover:bg-[#1E293B]"}`,children:r},r))})}),e.jsxs("div",{className:"mt-3 flex items-center gap-3 p-3 bg-[#1F2937] border border-[#1E293B] rounded-xl",children:[e.jsx("span",{className:"text-4xl",children:n.emoji}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-[#6a6a6f]",children:"Emoji selecionado"}),e.jsx("p",{className:"text-sm text-white font-medium",children:n.nome||"Sem nome"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-[10px] text-[#4a4a4f] uppercase tracking-wider mb-2",children:"DescriÃ§Ã£o (Opcional)"}),e.jsx("textarea",{value:n.descricao,onChange:r=>m({...n,descricao:r.target.value}),placeholder:"Descreva o segmento de mercado...",rows:3,disabled:i,className:"w-full bg-[#1F2937] border border-[#1E293B] rounded-xl px-4 py-3 text-white placeholder:text-[#4a4a4f] focus:outline-none focus:border-[#10B981]/50 resize-none disabled:opacity-50"})]})]}),h&&e.jsx("div",{className:"px-6 py-2 bg-red-500/10 border-t border-red-500/20",children:e.jsx("p",{className:"text-red-400 text-xs font-bold",children:h})}),e.jsxs("div",{className:"flex-shrink-0 p-6 border-t border-[#1F2937] flex gap-3",children:[e.jsx("button",{onClick:b,disabled:i,className:"flex-1 py-3 rounded-xl border border-[#1E293B] text-[#6a6a6f] font-semibold hover:bg-[#1F2937] transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:"Cancelar"}),e.jsx("button",{onClick:u,disabled:i,className:"flex-1 py-3 rounded-xl bg-[#10B981] text-black font-semibold hover:bg-[#059669] transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:i?"Salvando...":"Salvar"})]})]})})]})}const w=20;function ce(){const{usuario:s}=Q(),{alertModal:b,showAlert:p}=V(),[i,h]=l.useState([]),[x,n]=l.useState(!0),[m,u]=l.useState(""),[r,S]=l.useState(""),[c,y]=l.useState(1),[O,F]=l.useState(null),[z,M]=l.useState(!1),[T,B]=l.useState(!1),g=l.useRef(null),D=l.useCallback(t=>{S(t),g.current&&clearTimeout(g.current),g.current=setTimeout(()=>u(t),300)},[]),A=async()=>{if(s?.tenant_id){n(!0);try{const{data:t,error:d}=await N.from("segmentos").select("id, nome, emoji, created_at, tenant_id").eq("tenant_id",s.tenant_id).order("created_at",{ascending:!1}).limit(100);if(d)throw d;if(t&&t.length>0){const a=t.map(o=>o.id),{data:L}=await N.from("marcas").select("id, nome, emoji, id_segmento").in("id_segmento",a),k={};(L||[]).forEach(o=>{k[o.id_segmento]||(k[o.id_segmento]=[]),k[o.id_segmento].push(o)});const P=(L||[]).map(o=>o.id);let _={};if(P.length>0){const{data:o}=await N.from("leads").select("marca_id").in("marca_id",P);(o||[]).forEach(v=>{_[v.marca_id]=(_[v.marca_id]||0)+1})}const Z=t.map(o=>{const v=k[o.id]||[],$=v.reduce((J,K)=>J+(_[K.id]||0),0);return{...o,marcas_relacionadas:v,leadsCount:$}});h(Z)}else h([])}catch(t){console.error("Erro ao carregar segmentos:",t),h([])}finally{n(!1)}}};l.useEffect(()=>{A()},[s]),l.useEffect(()=>{y(1)},[m]),l.useEffect(()=>()=>{g.current&&clearTimeout(g.current)},[]);const f=i.filter(t=>t.nome?.toLowerCase().includes(m.toLowerCase())),j=Math.ceil(f.length/w),R=f.slice((c-1)*w,c*w),q=(c-1)*w+1,G=Math.min(c*w,f.length),C=(t=null)=>{F(t),M(!0)},I=()=>{M(!1),F(null),B(!1)},H=async t=>{B(!0);try{const d={tenant_id:s.tenant_id,nome:t.nome,emoji:t.emoji};if(t.id){const{error:a}=await N.from("segmentos").update(d).eq("id",t.id);if(a)throw a}else{const{error:a}=await N.from("segmentos").insert(d);if(a)throw a}await A(),I()}catch(d){console.error("Erro ao salvar segmento:",d),p({type:"error",title:"Erro ao salvar",message:d.message})}finally{B(!1)}};return x?e.jsx(W,{fullScreen:!1}):e.jsxs("div",{className:"text-white pb-32",children:[e.jsx("div",{className:"px-4 lg:px-10 pt-6 lg:pt-10 mb-6 lg:mb-8",children:e.jsxs(E.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},transition:{duration:.5},children:[e.jsxs("h1",{className:"text-2xl lg:text-4xl font-light text-white mb-2",children:["GestÃ£o de ",e.jsx("span",{className:"text-[#10B981] font-bold",children:"Segmentos"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-16 h-0.5 bg-[#10B981] rounded-full"}),e.jsxs("p",{className:"text-[8px] lg:text-[9px] text-gray-600 font-black uppercase tracking-[0.3em]",children:[i.length," ",i.length===1?"segmento cadastrado":"segmentos cadastrados"]})]})]})}),e.jsx("div",{className:"px-4 lg:px-10 mb-8",children:e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",placeholder:"ðŸ” Buscar segmento...",value:r,onChange:t=>D(t.target.value),className:`
              w-full
              bg-[#0F172A]
              border border-white/5
              rounded-2xl
              px-5 py-4
              lg:px-6 lg:py-4
              text-sm lg:text-base
              text-white
              placeholder:text-gray-600
              focus:outline-none
              focus:border-[#10B981]/50
              focus:ring-2
              focus:ring-[#10B981]/20
              transition-all
            `}),r&&e.jsx("button",{onClick:()=>{S(""),u("")},className:"absolute right-4 top-1/2 -translate-y-1/2 text-gray-500 hover:text-white transition-colors",children:"âœ•"})]})}),e.jsx("div",{className:"px-4 lg:px-10",children:f.length===0?e.jsxs(E.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},className:"text-center py-20",children:[e.jsx("div",{className:"text-6xl mb-4 opacity-30",children:"ðŸŽ¯"}),e.jsx("p",{className:"text-xl text-gray-400 mb-2",children:m?"Nenhum segmento encontrado":"Nenhum segmento cadastrado"}),e.jsx("p",{className:"text-sm text-gray-600 mb-6",children:m?"Tente ajustar sua busca":"Comece criando seu primeiro segmento!"}),m?e.jsx("button",{onClick:()=>{S(""),u("")},className:"px-6 py-3 bg-[#10B981] text-black font-bold rounded-xl hover:bg-[#059669] transition-all",children:"Limpar Busca"}):e.jsx("button",{onClick:()=>C(null),className:"px-6 py-3 bg-[#10B981] text-black font-bold rounded-xl hover:bg-[#059669] transition-all",children:"+ Criar Primeiro Segmento"})]}):e.jsxs("div",{className:"bg-[#0F172A] border border-white/5 rounded-3xl overflow-hidden",children:[e.jsx("div",{className:"p-4 lg:p-6",children:e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-4 lg:gap-6",children:R.map((t,d)=>e.jsx(X,{segmento:t,index:d,onClick:()=>C(t)},t.id))})}),e.jsx("div",{className:"px-4 py-4 border-t border-white/5 bg-[#0F172A] rounded-b-3xl",children:e.jsxs("div",{className:"flex flex-col lg:flex-row items-center justify-between gap-4",children:[e.jsxs("p",{className:"text-xs text-gray-600",children:["Exibindo ",e.jsx("span",{className:"text-white font-bold",children:q})," a"," ",e.jsx("span",{className:"text-white font-bold",children:G})," de"," ",e.jsx("span",{className:"text-white font-bold",children:f.length})," itens"]}),j>1&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>y(t=>Math.max(1,t-1)),disabled:c===1,className:"px-4 py-2 rounded-xl bg-white/5 border border-white/10 text-white text-xs font-bold hover:bg-white/10 transition-all disabled:opacity-30 disabled:cursor-not-allowed",children:"â† Anterior"}),e.jsx("div",{className:"flex items-center gap-1",children:[...Array(j)].map((t,d)=>{const a=d+1;return a===1||a===j||a>=c-1&&a<=c+1?e.jsx("button",{onClick:()=>y(a),className:`
                                w-8 h-8 rounded-lg text-xs font-bold transition-all
                                ${c===a?"bg-[#10B981] text-black":"bg-white/5 text-gray-400 hover:bg-white/10"}
                              `,children:a},a):a===c-2||a===c+2?e.jsx("span",{className:"text-gray-600",children:"..."},a):null})}),e.jsx("button",{onClick:()=>y(t=>Math.min(j,t+1)),disabled:c===j,className:"px-4 py-2 rounded-xl bg-white/5 border border-white/10 text-white text-xs font-bold hover:bg-white/10 transition-all disabled:opacity-30 disabled:cursor-not-allowed",children:"PrÃ³xima â†’"})]}),e.jsx("p",{className:"text-[9px] text-gray-700 font-black uppercase tracking-widest",children:"LeadCapture Pro Â· ZafalÃ£o Tech"})]})})]})}),e.jsx(U,{onClick:()=>C(null)}),z&&e.jsx(ee,{segmento:O,onClose:I,onSave:H,isSaving:T}),b]})}export{ce as default};
