import{j as e,m as b,A as P}from"./motion-CnUDAaLS.js";import{r as h,h as U}from"./react-vendor-DDxOQdDP.js";import{k as Q,s as N,u as T,a as G,C as z}from"./index-DNvzsDZk.js";import{u as H}from"./useQuery-CJKtlTfW.js";import{u as W,A as V}from"./useAlertModal-Den3me5c.js";import{F as J}from"./FAB-0kAuwrai.js";import{L as X}from"./LoadingSpinner-QA4ydWnx.js";import"./export-Dlusqx8k.js";import"./supabase-BCnEU3Yj.js";import"./analytics-BMD6QFpy.js";function Y({tenantId:t,page:x=1,perPage:u=20,filters:i={}}){return H({queryKey:["leads",t,x,u,i],queryFn:async()=>{let d=N.from("leads").select(`
          *,
          marca:id_marca (id, nome, emoji),
          operador:id_operador_responsavel (id, nome, role),
          status_comercial:id_status (id, label, slug, cor),
          motivo_desistencia:id_motivo_desistencia (id, nome)
        `,{count:"exact"}).eq("tenant_id",t).is("deleted_at",null);if(i.search){const j=i.search;d=d.or(`nome.ilike.%${j}%,email.ilike.%${j}%,telefone.ilike.%${j}%,cidade.ilike.%${j}%`)}if(i.status&&i.status!=="All"){const j=i.status.charAt(0).toUpperCase()+i.status.slice(1).toLowerCase();d=d.ilike("categoria",j)}i.meusLeads&&i.userId&&(d=d.eq("id_operador_responsavel",i.userId));const n=(x-1)*u,c=n+u-1,{data:l,error:a,count:k}=await d.order("created_at",{ascending:!1}).range(n,c);if(a)throw a;return{data:l??[],count:k??0}},enabled:!!t,placeholderData:Q})}function Z(t){return H({queryKey:["metrics",t],queryFn:async()=>{const{data:x,error:u}=await N.from("leads").select("categoria").eq("tenant_id",t).is("deleted_at",null);if(u)throw u;const i=x??[];return{total:i.length,hot:i.filter(d=>(d.categoria||"").toLowerCase()==="hot").length,warm:i.filter(d=>(d.categoria||"").toLowerCase()==="warm").length,cold:i.filter(d=>["cold",""].includes((d.categoria||"").toLowerCase())).length}},enabled:!!t,staleTime:1e3*60*2})}function ee(t,x=300){const[u,i]=h.useState(t);return h.useEffect(()=>{const d=setTimeout(()=>{i(t)},x);return()=>{clearTimeout(d)}},[t,x]),u}function te({kpis:t,kpiAtivo:x,setKpiAtivo:u}){const i=[{id:"All",label:"Total",value:t.total,icon:"ðŸ“Š",color:"#10B981",textColor:"text-[#10B981]",bg:"bg-[#10B981]/10",border:"border-[#10B981]/30"},{id:"Hot",label:"Hot",value:t.hot,icon:"ðŸ”¥",color:"#ef4444",textColor:"text-red-400",bg:"bg-red-500/10",border:"border-red-500/30"},{id:"Warm",label:"Warm",value:t.warm,icon:"ðŸŒ¤ï¸",color:"#eab308",textColor:"text-yellow-400",bg:"bg-yellow-500/10",border:"border-yellow-500/30"},{id:"Cold",label:"Cold",value:t.cold,icon:"â„ï¸",color:"#3b82f6",textColor:"text-blue-400",bg:"bg-blue-500/10",border:"border-blue-500/30"}],d=t.total||1;return e.jsx("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-3 lg:gap-4",children:i.map(n=>{const c=x===n.id,l=Math.round(n.value/d*100)||0;return e.jsxs(b.button,{whileHover:{scale:1.02,y:-2},whileTap:{scale:.98},onClick:()=>u(n.id),className:`
              relative text-left
              rounded-2xl p-4 lg:p-5
              border transition-all
              ${c?n.bg+" "+n.border+" shadow-lg":"bg-[#1E293B] border-white/5 hover:border-white/10"}
            `,children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsx("span",{className:"text-2xl",children:n.icon}),c&&e.jsx("span",{className:`text-[10px] font-black uppercase tracking-widest px-2 py-0.5 rounded-full ${n.bg} ${n.textColor} border ${n.border}`,children:"Ativo"})]}),e.jsx("div",{className:`text-3xl lg:text-4xl font-black mb-1 ${c?n.textColor:"text-white"}`,children:n.value}),e.jsx("div",{className:"text-xs font-bold uppercase tracking-widest text-gray-500 mb-3",children:n.label}),n.id!=="All"&&e.jsx("div",{className:"w-full bg-white/5 rounded-full h-1.5 overflow-hidden",children:e.jsx(b.div,{initial:{width:0},animate:{width:c?`${l}%`:`${l}%`},transition:{duration:.8,ease:"easeOut"},className:"h-full rounded-full",style:{backgroundColor:n.color}})}),n.id==="All"&&e.jsx("div",{className:"w-full bg-white/5 rounded-full h-1.5 overflow-hidden",children:e.jsx(b.div,{initial:{width:0},animate:{width:"100%"},transition:{duration:.8,ease:"easeOut"},className:"h-full rounded-full bg-[#10B981]"})}),c&&e.jsx(b.div,{layoutId:"activeKPI",className:`absolute inset-0 rounded-2xl border-2 ${n.border} pointer-events-none`,transition:{type:"spring",bounce:.2,duration:.6}})]},n.id)})})}const ae=["Administrador","admin","Diretor","Gestor"];function se({lead:t,onClose:x}){const{usuario:u}=T(),i=G(),{alertModal:d,showAlert:n}=W(),c=ae.includes(u?.role),l=!t?.id,[a,k]=h.useState({nome:t?.nome||"",email:t?.email||"",telefone:t?.telefone||"",cidade:t?.cidade||"",estado:t?.estado||"",capital_disponivel:t?.capital_disponivel||0,id_status:t?.id_status||"",id_motivo_desistencia:t?.id_motivo_desistencia||"",categoria:t?.categoria||"Cold",score:t?.score||0,fonte:t?.fonte||"",id_marca:t?.id_marca||t?.marca?.id||"",resumo_qualificacao:t?.resumo_qualificacao||"",mensagem_original:t?.mensagem_original||"",experiencia_anterior:t?.experiencia_anterior||!1,urgencia:t?.urgencia||"normal"}),[j,_]=h.useState([]),[y,C]=h.useState(t?.status_comercial?[{id:t.status_comercial.id,label:t.status_comercial.label,slug:t.status_comercial.slug}]:[]),[F,B]=h.useState([]),[w,L]=h.useState(!1),S=y.find(o=>o.id===a.id_status)?.slug==="perdido";h.useEffect(()=>{if(!u?.tenant_id)return;async function o(){if(!u?.tenant_id)return;const p=u.tenant_id,[{data:A,error:O},{data:v,error:D},{data:q,error:M}]=await Promise.all([N.from("marcas").select("id, nome, emoji").eq("tenant_id",p).eq("ativo",!0).order("nome"),N.from("status_comercial").select("id, label, slug").eq("tenant_id",p),N.from("motivos_desistencia").select("id, nome").eq("tenant_id",p).eq("ativo",!0).order("nome")]);O&&console.error("Erro ao buscar marcas:",O),D&&console.error("Erro ao buscar status_comercial:",D),M&&console.error("Erro ao buscar motivos_desistencia:",M),A&&_(A),v&&C(v),q&&B(q)}o()},[u?.tenant_id]);const g=o=>{const{name:p,value:A,type:O,checked:v}=o.target;k(D=>{const q={...D,[p]:O==="checkbox"?v:A};if(p==="id_status"){const M=y.find(s=>s.id===A);M&&M.slug!=="perdido"&&(q.id_motivo_desistencia="")}return q})},E=async o=>{if(o?.preventDefault(),l&&!a.id_marca){n({type:"warning",title:"Campo ObrigatÃ³rio",message:"Selecione uma Marca de Interesse!"});return}if(S&&!a.id_motivo_desistencia){n({type:"warning",title:"Campo ObrigatÃ³rio",message:"Informe o motivo da desistÃªncia!"});return}L(!0);try{const p={nome:a.nome,email:a.email,telefone:a.telefone,cidade:a.cidade,estado:a.estado,capital_disponivel:Number(a.capital_disponivel),id_status:a.id_status||null,id_motivo_desistencia:S&&a.id_motivo_desistencia||null,categoria:a.categoria,score:Number(a.score),fonte:a.fonte,id_marca:a.id_marca||null,resumo_qualificacao:a.resumo_qualificacao,mensagem_original:a.mensagem_original,experiencia_anterior:a.experiencia_anterior,urgencia:a.urgencia},A={id_status:a.id_status||null,id_motivo_desistencia:S&&a.id_motivo_desistencia||null,resumo_qualificacao:a.resumo_qualificacao},O=c?p:A;if(l){const{error:v}=await N.from("leads").insert([{...p,tenant_id:u.tenant_id}]);if(v)throw v}else{const{error:v}=await N.from("leads").update({...O,updated_at:new Date().toISOString()}).eq("id",t.id);if(v)throw v}i.invalidateQueries({queryKey:["leads"]}),i.invalidateQueries({queryKey:["metrics"]}),x()}catch(p){console.error("Erro ao salvar lead:",p),n({type:"error",title:"Erro ao Salvar",message:p.message})}finally{L(!1)}},f="w-full bg-white/5 border border-white/10 rounded-xl px-4 py-3 text-[#F8FAFC] placeholder:text-gray-600 focus:outline-none focus:border-[#10B981]/50 focus:ring-2 focus:ring-[#10B981]/20 transition-all",r="w-full bg-white/3 border border-white/5 rounded-xl px-4 py-3 text-gray-400",m="block text-sm font-bold text-gray-400 mb-2";return e.jsxs(P,{children:[e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:[e.jsx(b.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:x,className:"absolute inset-0 bg-black/60 backdrop-blur-sm"}),e.jsxs(b.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:20},className:"relative w-full max-w-2xl max-h-[90vh] bg-[#1E293B] rounded-3xl shadow-2xl border border-white/10 overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"px-6 py-5 border-b border-white/5 flex-shrink-0 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-gradient-to-br from-[#10B981] to-[#059669] flex items-center justify-center text-white font-bold text-lg",children:t?.nome?.charAt(0).toUpperCase()||"+"}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-white",children:l?"Novo Lead":"Editar Lead"}),e.jsx("p",{className:"text-sm text-gray-400",children:l?"Preencha as informaÃ§Ãµes":t.nome})]})]}),e.jsx("button",{onClick:x,className:"w-8 h-8 rounded-full bg-white/5 hover:bg-white/10 flex items-center justify-center text-gray-400 hover:text-white transition-all",children:"âœ•"})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto px-6 py-6 space-y-4",children:[!c&&!l&&e.jsxs("div",{className:"bg-blue-500/10 border border-blue-500/30 rounded-xl p-3 flex items-center gap-2",children:[e.jsx("span",{children:"ðŸ’¼"}),e.jsx("p",{className:"text-xs text-blue-400 font-bold",children:"Consultor: vocÃª pode alterar Status e ObservaÃ§Ãµes"})]}),t?.operador&&e.jsxs("div",{className:"bg-purple-500/10 border border-purple-500/30 rounded-2xl p-4 flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-gradient-to-br from-purple-500 to-pink-500 flex items-center justify-center text-white font-bold",children:t.operador.nome?.charAt(0).toUpperCase()}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-purple-400 font-bold uppercase tracking-wider",children:"Operador ResponsÃ¡vel"}),e.jsx("p",{className:"text-sm font-bold text-white",children:t.operador.nome}),e.jsx("p",{className:"text-xs text-purple-300",children:t.operador.role})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"lg:col-span-2",children:[e.jsx("label",{className:m,children:"Nome Completo *"}),c||l?e.jsx("input",{type:"text",name:"nome",value:a.nome,onChange:g,required:!0,className:f,placeholder:"Nome completo"}):e.jsx("div",{className:r,children:a.nome})]}),e.jsxs("div",{children:[e.jsx("label",{className:m,children:"Email"}),c||l?e.jsx("input",{type:"email",name:"email",value:a.email,onChange:g,className:f,placeholder:"email@exemplo.com"}):e.jsx("div",{className:r,children:a.email||"â€”"})]}),e.jsxs("div",{children:[e.jsx("label",{className:m,children:"Telefone"}),c||l?e.jsx("input",{type:"tel",name:"telefone",value:a.telefone,onChange:g,className:f,placeholder:"(00) 00000-0000"}):e.jsx("div",{className:r,children:a.telefone||"â€”"})]}),e.jsxs("div",{children:[e.jsx("label",{className:m,children:"Cidade"}),c||l?e.jsx("input",{type:"text",name:"cidade",value:a.cidade,onChange:g,className:f,placeholder:"SÃ£o Paulo"}):e.jsx("div",{className:r,children:a.cidade||"â€”"})]}),e.jsxs("div",{children:[e.jsx("label",{className:m,children:"Estado"}),c||l?e.jsx("input",{type:"text",name:"estado",value:a.estado,onChange:g,maxLength:2,className:f+" uppercase",placeholder:"SP"}):e.jsx("div",{className:r,children:a.estado||"â€”"})]}),e.jsxs("div",{children:[e.jsx("label",{className:m,children:"ðŸ·ï¸ Marca de Interesse *"}),l?e.jsxs("select",{name:"id_marca",value:a.id_marca,onChange:g,required:!0,className:f,children:[e.jsx("option",{value:"",children:"Selecione a marca"}),j.map(o=>e.jsxs("option",{value:o.id,children:[o.emoji," ",o.nome]},o.id))]}):e.jsxs("div",{className:"flex items-center gap-2 bg-white/5 border border-white/5 rounded-xl px-4 py-3",children:[e.jsx("span",{className:"text-xl",children:t?.marca?.emoji}),e.jsx("span",{className:"text-white font-bold",children:t?.marca?.nome||"â€”"}),e.jsx("span",{className:"ml-auto text-[10px] text-gray-600 bg-white/5 px-2 py-0.5 rounded-full uppercase tracking-wider",children:"Fixo"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:m,children:"Capital DisponÃ­vel (R$)"}),c||l?e.jsx("input",{type:"number",name:"capital_disponivel",value:a.capital_disponivel,onChange:g,min:"0",step:"1000",className:f,placeholder:"0"}):e.jsx("div",{className:r,children:a.capital_disponivel?`R$ ${Number(a.capital_disponivel).toLocaleString("pt-BR")}`:"â€”"})]}),e.jsxs("div",{children:[e.jsx("label",{className:m,children:"ðŸ“‹ Status Comercial"}),e.jsxs("select",{name:"id_status",value:a.id_status,onChange:g,className:f,children:[e.jsx("option",{value:"",children:"Selecione o status"}),y.map(o=>e.jsx("option",{value:o.id,children:o.label},o.id))]})]}),S&&e.jsxs(b.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},children:[e.jsx("label",{className:m+" !text-red-400",children:"âš ï¸ Motivo da DesistÃªncia *"}),e.jsxs("select",{name:"id_motivo_desistencia",value:a.id_motivo_desistencia,onChange:g,required:!0,className:f+" border-red-500/30 focus:border-red-500/50",children:[e.jsx("option",{value:"",children:"Selecione o motivo"}),F.map(o=>e.jsx("option",{value:o.id,children:o.nome},o.id))]})]}),(c||l)&&e.jsxs("div",{children:[e.jsx("label",{className:m,children:"Categoria"}),e.jsxs("select",{name:"categoria",value:a.categoria,onChange:g,className:f,children:[e.jsx("option",{value:"Hot",children:"ðŸ”¥ Hot"}),e.jsx("option",{value:"Warm",children:"ðŸŒ¤ï¸ Warm"}),e.jsx("option",{value:"Cold",children:"â„ï¸ Cold"})]})]}),(c||l)&&e.jsxs("div",{children:[e.jsx("label",{className:m,children:"Score (0-100)"}),e.jsx("input",{type:"number",name:"score",value:a.score,onChange:g,min:"0",max:"100",className:f})]}),(c||l)&&e.jsxs("div",{className:"lg:col-span-2",children:[e.jsx("label",{className:m,children:"Fonte"}),e.jsx("input",{type:"text",name:"fonte",value:a.fonte,onChange:g,className:f,placeholder:"Instagram, Facebook, Site..."})]}),(c||l)&&e.jsxs("div",{className:"lg:col-span-2 flex items-center gap-3 bg-white/5 border border-white/10 rounded-xl px-4 py-3",children:[e.jsx("input",{type:"checkbox",name:"experiencia_anterior",id:"exp_ant",checked:a.experiencia_anterior,onChange:g,className:"w-4 h-4 accent-[#10B981]"}),e.jsx("label",{htmlFor:"exp_ant",className:"text-sm text-gray-300 cursor-pointer",children:"Tem experiÃªncia anterior com franquias"})]}),e.jsxs("div",{className:"lg:col-span-2",children:[e.jsx("label",{className:m,children:"ðŸ“ ObservaÃ§Ãµes / Resumo"}),e.jsx("textarea",{name:"resumo_qualificacao",value:a.resumo_qualificacao,onChange:g,rows:3,className:f+" resize-none",placeholder:"AnotaÃ§Ãµes sobre o lead..."})]}),t?.mensagem_original&&e.jsxs("div",{className:"lg:col-span-2",children:[e.jsx("label",{className:m,children:"Mensagem Original"}),e.jsx("div",{className:"bg-white/5 border border-white/10 rounded-xl px-4 py-3 text-gray-300 text-sm",children:t.mensagem_original})]})]})]}),e.jsxs("div",{className:"px-6 py-4 border-t border-white/5 flex gap-3 flex-shrink-0",children:[e.jsx(b.button,{whileHover:{scale:1.02},whileTap:{scale:.98},onClick:x,disabled:w,type:"button",className:"flex-1 px-6 py-3 rounded-xl bg-white/5 border border-white/10 text-white font-bold hover:bg-white/10 transition-all disabled:opacity-50",children:"Cancelar"}),e.jsx(b.button,{whileHover:{scale:1.02},whileTap:{scale:.98},onClick:E,disabled:w,type:"button",className:"flex-1 px-6 py-3 rounded-xl bg-gradient-to-r from-[#10B981] to-[#059669] text-black font-bold hover:shadow-lg hover:shadow-[#10B981]/20 transition-all disabled:opacity-50 flex items-center justify-center gap-2",children:w?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"w-4 h-4 border-2 border-black/30 border-t-black rounded-full animate-spin"}),"Salvando..."]}):e.jsxs(e.Fragment,{children:["âœ“ ",l?"Criar Lead":"Salvar AlteraÃ§Ãµes"]})})]})]})]}),d]})}function re({lead:t,onClose:x,onSuccess:u}){const{usuario:i}=T(),d=G(),[n,c]=h.useState([]),[l,a]=h.useState(t?.id_operador_responsavel||null),[k,j]=h.useState(!0),[_,y]=h.useState(!1),[C,F]=h.useState({isOpen:!1,type:"info",title:"",message:""}),[B,w]=h.useState(!1),L=(r,m,o)=>{F({isOpen:!0,type:r,title:m,message:o})};h.useEffect(()=>{R()},[]);const R=async()=>{try{j(!0);const{data:r,error:m}=await N.from("usuarios").select("id, nome, email, role").eq("tenant_id",i.tenant_id).eq("active",!0).in("role",["Administrador","Diretor","Gestor","Consultor","Operador"]).order("nome",{ascending:!0});if(m)throw m;let o=r||[];i.role==="Consultor"?o=o.filter(p=>p.id===i.id):i.role==="Gestor"&&(o=o.filter(p=>p.id===i.id||["Consultor","Operador"].includes(p.role))),c(o)}catch(r){console.error("Erro ao buscar operadores:",r)}finally{j(!1)}},S=async()=>{if(!l){L("warning","AtenÃ§Ã£o","Selecione um operador antes de continuar.");return}y(!0);try{const{error:r}=await N.from("leads").update({id_operador_responsavel:l,updated_at:new Date().toISOString()}).eq("id",t.id);if(r)throw r;d.invalidateQueries({queryKey:["leads"]}),u?.(),x()}catch(r){L("error","Erro ao atribuir",r.message)}finally{y(!1)}},g=async()=>{y(!0);try{const{error:r}=await N.from("leads").update({id_operador_responsavel:null,updated_at:new Date().toISOString()}).eq("id",t.id);if(r)throw r;d.invalidateQueries({queryKey:["leads"]}),u?.(),x()}catch(r){L("error","Erro ao remover",r.message)}finally{y(!1)}},E={Administrador:"ðŸ‘‘",Diretor:"ðŸŽ¯",Gestor:"ðŸ“Š",Consultor:"ðŸ’¼",Operador:"âš™ï¸"},f={Administrador:"bg-purple-500/10 border-purple-500/30 text-purple-400",Diretor:"bg-blue-500/10 border-blue-500/30 text-blue-400",Gestor:"bg-green-500/10 border-green-500/30 text-green-400",Consultor:"bg-orange-500/10 border-orange-500/30 text-orange-400",Operador:"bg-gray-500/10 border-gray-500/30 text-gray-400"};return e.jsxs(P,{children:[e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:[e.jsx(b.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:x,className:"absolute inset-0 bg-black/60 backdrop-blur-sm"}),e.jsxs(b.div,{initial:{opacity:0,scale:.95,y:20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.95,y:20},className:"relative w-full max-w-md bg-[#0F172A] rounded-3xl shadow-2xl border border-white/10 overflow-hidden",children:[e.jsxs("div",{className:"px-6 py-5 border-b border-white/5 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-white",children:"ðŸ‘¤ Atribuir Operador"}),e.jsx("p",{className:"text-sm text-gray-400 mt-1",children:t?.nome})]}),e.jsx("button",{onClick:x,className:"w-8 h-8 rounded-full bg-white/5 hover:bg-white/10 flex items-center justify-center text-gray-400 hover:text-white transition-all",children:"âœ•"})]}),e.jsx("div",{className:"px-6 py-6 max-h-[60vh] overflow-y-auto",children:k?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx("div",{className:"w-8 h-8 border-2 border-[#10B981] border-t-transparent rounded-full animate-spin"})}):n.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"text-4xl mb-4",children:"ðŸ¤·"}),e.jsx("p",{className:"text-gray-400",children:"Nenhum operador disponÃ­vel"})]}):e.jsxs("div",{className:"space-y-3",children:[e.jsx("p",{className:"text-sm font-bold text-gray-400 mb-3",children:"Selecione o ResponsÃ¡vel"}),n.map(r=>{const m=l===r.id;return e.jsxs(b.button,{type:"button",whileHover:{scale:1.02},whileTap:{scale:.98},onClick:()=>a(r.id),className:`w-full flex items-center gap-3 px-4 py-3 rounded-xl border-2 transition-all ${m?f[r.role]+" shadow-lg":"bg-white/5 border-white/10 text-gray-400 hover:bg-white/10"}`,children:[e.jsx("div",{className:`w-10 h-10 rounded-full flex items-center justify-center font-bold text-sm flex-shrink-0 ${m?"bg-gradient-to-br from-[#10B981] to-[#059669] text-white":"bg-white/10 text-gray-400"}`,children:r.nome.charAt(0).toUpperCase()}),e.jsxs("div",{className:"flex-1 text-left",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-bold text-white",children:r.nome}),e.jsx("span",{children:E[r.role]})]}),e.jsx("div",{className:"text-xs opacity-70",children:r.role})]}),m&&e.jsx(b.span,{initial:{scale:0},animate:{scale:1},children:"âœ“"})]},r.id)})]})}),e.jsxs("div",{className:"px-6 py-4 border-t border-white/5 flex gap-3",children:[t?.id_operador_responsavel&&e.jsx(b.button,{whileHover:{scale:1.02},whileTap:{scale:.98},onClick:()=>w(!0),disabled:_,className:"px-4 py-3 rounded-xl bg-red-500/10 border border-red-500/30 text-red-400 font-bold hover:bg-red-500/20 transition-all disabled:opacity-50",children:"Remover"}),e.jsx(b.button,{whileHover:{scale:1.02},whileTap:{scale:.98},onClick:x,disabled:_,className:"flex-1 px-6 py-3 rounded-xl bg-white/5 border border-white/10 text-white font-bold hover:bg-white/10 transition-all disabled:opacity-50",children:"Cancelar"}),e.jsx(b.button,{whileHover:{scale:1.02},whileTap:{scale:.98},onClick:S,disabled:_||!l||l===t?.id_operador_responsavel,className:"flex-1 px-6 py-3 rounded-xl bg-gradient-to-r from-[#10B981] to-[#059669] text-black font-bold hover:shadow-lg transition-all disabled:opacity-50 flex items-center justify-center gap-2",children:_?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"w-4 h-4 border-2 border-black/30 border-t-black rounded-full animate-spin"}),"Salvando..."]}):"âœ“ Atribuir"})]})]})]}),e.jsx(V,{isOpen:C.isOpen,type:C.type,title:C.title,message:C.message,onClose:()=>F(r=>({...r,isOpen:!1}))}),e.jsx(z,{isOpen:B,title:"Remover atribuiÃ§Ã£o",message:"Deseja remover a atribuiÃ§Ã£o do operador deste lead?",onConfirm:g,onClose:()=>w(!1)})]})}const le=["Administrador","admin","Diretor","Gestor"],ie=["Consultor"];function ge(){const{usuario:t}=T(),[x,u]=h.useState(1),[i]=h.useState(20),[d,n]=h.useState("All"),[c,l]=h.useState(""),[a,k]=h.useState(!1),j=ee(c,500),{data:_,isLoading:y,isPlaceholderData:C}=Y({tenantId:t?.tenant_id,page:x,perPage:i,filters:{search:j,status:d,meusLeads:a,userId:t?.id}}),F=_?.data||[],B=_?.count||0,w=Math.ceil(B/i),{data:L}=Z(t?.tenant_id),[R,S]=h.useState(null),[g,E]=h.useState(!1),[f,r]=h.useState(!1),[m,o]=h.useState(null),p=s=>{S(s),E(!0)},A=()=>{E(!1),S(null)},O=s=>{o(s),r(!0)},v=()=>{r(!1),o(null)};U.useEffect(()=>{u(1)},[d,a,j]);const D=L||{total:0,hot:0,warm:0,cold:0},q=le.includes(t?.role),M=ie.includes(t?.role);return y?e.jsx(X,{}):e.jsxs("div",{className:"min-h-screen bg-[#0F172A] text-[#F8FAFC] pb-32",children:[e.jsx("div",{className:"px-4 lg:px-10 pt-6 lg:pt-10 mb-6 lg:mb-8",children:e.jsxs(b.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},transition:{duration:.5},children:[e.jsxs("h1",{className:"text-2xl lg:text-4xl font-light text-white mb-2",children:["OlÃ¡, ",e.jsx("span",{className:"text-[#10B981] font-bold",children:t?.nome?.split(" ")[0]})," ðŸ‘‹"]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-16 h-0.5 bg-[#10B981] rounded-full"}),e.jsx("p",{className:"text-[8px] lg:text-[9px] text-gray-600 font-black uppercase tracking-[0.3em]",children:"Dashboard de GestÃ£o de Leads"})]})]})}),e.jsx("div",{className:"px-4 lg:px-10 mb-8",children:e.jsx(te,{kpis:D,kpiAtivo:d,setKpiAtivo:n})}),e.jsx("div",{className:"px-4 lg:px-10 mb-8",children:e.jsxs("div",{className:"flex flex-col lg:flex-row gap-3",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx("input",{type:"text",placeholder:"ðŸ” Buscar por nome, email, telefone ou cidade...",value:c,onChange:s=>l(s.target.value),className:"w-full bg-[#1E293B] border border-white/5 rounded-2xl px-5 py-4 text-sm text-[#F8FAFC] placeholder:text-gray-600 focus:outline-none focus:border-[#10B981]/50 focus:ring-2 focus:ring-[#10B981]/20 transition-all"}),c&&e.jsx("button",{onClick:()=>l(""),className:"absolute right-4 top-1/2 -translate-y-1/2 text-gray-500 hover:text-white",children:"âœ•"})]}),e.jsxs(b.button,{whileHover:{scale:1.02},whileTap:{scale:.98},onClick:()=>k(!a),className:`flex items-center justify-center gap-2 px-6 py-4 rounded-2xl font-bold transition-all whitespace-nowrap ${a?"bg-gradient-to-r from-[#10B981] to-[#059669] text-black shadow-lg":"bg-[#1E293B] border border-white/5 text-[#F8FAFC] hover:bg-white/5"}`,children:[e.jsx("span",{children:a?"âœ“":"ðŸ‘¤"}),e.jsx("span",{className:"hidden lg:inline",children:"Meus Leads"})]})]})}),e.jsx("div",{className:"px-4 lg:px-10",children:F.length===0?e.jsxs(b.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},className:"text-center py-20",children:[e.jsx("div",{className:"text-6xl mb-4 opacity-30",children:"ðŸ“­"}),e.jsx("p",{className:"text-xl text-gray-400 mb-2",children:c||d!=="All"||a?"Nenhum lead encontrado":"Nenhum lead cadastrado"}),e.jsx("p",{className:"text-sm text-gray-600 mb-6",children:c||d!=="All"||a?"Tente ajustar os filtros":"Comece importando ou criando seus leads!"}),(c||d!=="All"||a)&&e.jsx("button",{onClick:()=>{l(""),n("All"),k(!1)},className:"px-6 py-3 bg-[#10B981] text-black font-bold rounded-xl hover:bg-[#059669] transition-all",children:"Limpar Filtros"})]}):e.jsxs("div",{className:"bg-[#1E293B] border border-white/5 rounded-3xl overflow-hidden",children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-white/5",children:[e.jsx("th",{className:"px-4 py-4 text-left text-xs font-black text-gray-500 uppercase tracking-wider",children:"Nome"}),e.jsx("th",{className:"px-4 py-4 text-left text-xs font-black text-gray-500 uppercase tracking-wider hidden lg:table-cell",children:"Contato"}),e.jsx("th",{className:"px-4 py-4 text-left text-xs font-black text-gray-500 uppercase tracking-wider hidden xl:table-cell",children:"LocalizaÃ§Ã£o"}),e.jsx("th",{className:"px-4 py-4 text-left text-xs font-black text-gray-500 uppercase tracking-wider hidden lg:table-cell",children:"Marca"}),e.jsx("th",{className:"px-4 py-4 text-left text-xs font-black text-gray-500 uppercase tracking-wider hidden lg:table-cell",children:"Score"}),e.jsx("th",{className:"px-4 py-4 text-left text-xs font-black text-gray-500 uppercase tracking-wider",children:"Status"}),e.jsx("th",{className:"px-4 py-4 text-left text-xs font-black text-gray-500 uppercase tracking-wider hidden lg:table-cell",children:"Status Comercial"}),e.jsx("th",{className:"px-4 py-4 text-left text-xs font-black text-gray-500 uppercase tracking-wider hidden xl:table-cell",children:"AtribuÃ­do"}),e.jsx("th",{className:"px-4 py-4 text-right text-xs font-black text-gray-500 uppercase tracking-wider",children:"AÃ§Ãµes"})]})}),e.jsx("tbody",{children:F.map((s,K)=>e.jsxs(b.tr,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:Math.min(K*.03,.3)},className:"border-b border-white/5 hover:bg-white/5 transition-colors",children:[e.jsx("td",{className:"px-4 py-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-gradient-to-br from-[#10B981] to-[#059669] flex items-center justify-center text-white font-bold flex-shrink-0",children:s.nome?.charAt(0).toUpperCase()}),e.jsxs("div",{children:[e.jsx("div",{className:"font-bold text-white",children:s.nome}),e.jsx("div",{className:"text-xs text-gray-500",children:s.fonte||"â€”"})]})]})}),e.jsxs("td",{className:"px-4 py-4 hidden lg:table-cell",children:[e.jsx("div",{className:"text-sm text-white font-medium",children:s.telefone||"â€”"}),e.jsx("div",{className:"text-xs text-gray-500",children:s.email||"â€”"})]}),e.jsx("td",{className:"px-4 py-4 hidden xl:table-cell",children:e.jsx("div",{className:"text-sm text-gray-300",children:s.cidade&&s.estado?`${s.cidade} - ${s.estado}`:s.regiao_interesse||"â€”"})}),e.jsx("td",{className:"px-4 py-4 hidden lg:table-cell",children:s.marca?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-lg",children:s.marca.emoji}),e.jsx("span",{className:"text-sm text-gray-300",children:s.marca.nome})]}):e.jsx("span",{className:"text-xs text-gray-600",children:"Sem marca"})}),e.jsx("td",{className:"px-4 py-4 hidden lg:table-cell",children:e.jsx("span",{className:"text-sm font-bold text-gray-300",children:s.score||0})}),e.jsx("td",{className:"px-4 py-4",children:e.jsxs("span",{className:`inline-flex items-center gap-1 px-3 py-1 rounded-full text-xs font-bold ${s.categoria?.toLowerCase()==="hot"?"bg-red-500/10 text-red-400 border border-red-500/30":s.categoria?.toLowerCase()==="warm"?"bg-yellow-500/10 text-yellow-400 border border-yellow-500/30":"bg-blue-500/10 text-blue-400 border border-blue-500/30"}`,children:[s.categoria?.toLowerCase()==="hot"&&"ðŸ”¥",s.categoria?.toLowerCase()==="warm"&&"ðŸŒ¤ï¸",s.categoria?.toLowerCase()==="cold"&&"â„ï¸",s.categoria||"Cold"]})}),e.jsx("td",{className:"px-4 py-4 hidden lg:table-cell",children:(()=>{const I=s.status_comercial?.label||s.status,$=s.status_comercial?.slug||s.status||"";return I?e.jsx("span",{className:`inline-flex items-center px-3 py-1 rounded-full text-xs font-bold border ${$.toLowerCase().includes("vendido")||$.toLowerCase().includes("convertido")?"bg-green-500/10 text-green-400 border-green-500/30":$.toLowerCase().includes("negoc")?"bg-blue-500/10 text-blue-400 border-blue-500/30":$.toLowerCase().includes("perdido")?"bg-red-500/10 text-red-400 border-red-500/30":$.toLowerCase().includes("agendado")?"bg-purple-500/10 text-purple-400 border-purple-500/30":$.toLowerCase().includes("contato")?"bg-yellow-500/10 text-yellow-400 border-yellow-500/30":"bg-gray-500/10 text-gray-400 border-gray-500/30"}`,children:I}):e.jsx("span",{className:"text-xs text-gray-600 italic",children:"â€”"})})()}),e.jsx("td",{className:"px-4 py-4 hidden xl:table-cell",children:s.operador?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-7 h-7 rounded-full bg-gradient-to-br from-purple-500 to-pink-500 flex items-center justify-center text-white text-xs font-bold flex-shrink-0",children:s.operador.nome?.charAt(0).toUpperCase()}),e.jsx("span",{className:"text-sm text-gray-300 truncate max-w-[100px]",children:s.operador.nome})]}):e.jsx("span",{className:"text-xs text-gray-600 italic",children:"NÃ£o atribuÃ­do"})}),e.jsx("td",{className:"px-4 py-4 text-right",children:e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[q&&e.jsxs("button",{onClick:()=>O(s),className:"px-3 py-2 rounded-lg bg-blue-500/10 border border-blue-500/30 text-blue-400 text-xs font-bold hover:bg-blue-500/20 transition-all flex items-center gap-1",title:"Atribuir operador",children:[e.jsx("span",{children:"ðŸ‘¤"}),e.jsx("span",{className:"hidden lg:inline",children:"Atribuir"})]}),e.jsx("button",{onClick:()=>p(s),className:"px-3 py-2 rounded-lg bg-white/5 border border-white/10 text-white text-xs font-bold hover:bg-white/10 transition-all",children:"Ver detalhes"})]})})]},s.id))})]})}),B>0&&e.jsxs("div",{className:"px-4 py-4 flex items-center justify-between border-t border-white/5",children:[e.jsx("button",{onClick:()=>u(s=>Math.max(s-1,1)),disabled:x===1,className:"px-4 py-2 bg-white/5 hover:bg-white/10 rounded-lg disabled:opacity-50 disabled:cursor-not-allowed transition-colors text-sm font-bold text-gray-400",children:"â† Anterior"}),e.jsxs("span",{className:"text-xs lg:text-sm text-gray-500",children:["PÃ¡gina ",e.jsx("span",{className:"text-[#F8FAFC]",children:x})," de ",e.jsx("span",{className:"text-[#F8FAFC]",children:w})," Â· ",e.jsx("span",{className:"text-[#10B981]",children:B})," leads"]}),e.jsx("button",{onClick:()=>{!C&&x<w&&u(s=>s+1)},disabled:C||x>=w,className:"px-4 py-2 bg-white/5 hover:bg-white/10 rounded-lg disabled:opacity-50 disabled:cursor-not-allowed transition-colors text-sm font-bold text-gray-400",children:"PrÃ³ximo â†’"})]})]})}),e.jsx(J,{onClick:()=>p(null)}),g&&e.jsx(se,{lead:R,onClose:A,isGestor:q,isConsultor:M,usuarioRole:t?.role}),f&&m&&e.jsx(re,{lead:m,onClose:v,onSuccess:()=>{}})]})}export{ge as default};
