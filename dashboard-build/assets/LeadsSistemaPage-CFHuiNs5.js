import{j as e,m as p,A as J}from"./motion-CnUDAaLS.js";import{r}from"./react-vendor-DDxOQdDP.js";import{u as V,s as P}from"./index-DNvzsDZk.js";import{u as Y}from"./useAlertModal-Den3me5c.js";import{L as K}from"./LoadingSpinner-QA4ydWnx.js";import{u as T,w as Q}from"./export-Dlusqx8k.js";import"./supabase-BCnEU3Yj.js";import"./analytics-BMD6QFpy.js";const C=20,D=[{slug:"novo",label:"Novo"},{slug:"contato",label:"Em Contato"},{slug:"negociacao",label:"NegociaÃ§Ã£o"},{slug:"fechado",label:"Fechado"},{slug:"perdido",label:"Perdido"}],B={novo:"bg-blue-500/10 text-blue-400 border-blue-500/30",contato:"bg-yellow-500/10 text-yellow-400 border-yellow-500/30",negociacao:"bg-orange-500/10 text-orange-400 border-orange-500/30",fechado:"bg-green-500/10 text-green-400 border-green-500/30",perdido:"bg-gray-500/10 text-gray-400 border-gray-500/30"},L={novo:"ðŸ†•",contato:"ðŸ“ž",negociacao:"ðŸ¤",fechado:"âœ…",perdido:"âŒ"};function O(a){return a?new Date(a).toLocaleDateString("pt-BR",{day:"2-digit",month:"2-digit",year:"numeric"}):"â€”"}function X({prospect:a,onClose:v,onSaved:w,statusOpts:c,motivosDesistencia:j}){const[n,F]=r.useState(a?.status||"novo"),[h,E]=r.useState(a?.motivo_desistencia_id||""),[m,y]=r.useState(a?.observacao_interna||""),[x,f]=r.useState(!1),[i,b]=r.useState(null);if(!a)return null;const u=n==="perdido",N=async()=>{f(!0),b(null);const{error:s}=await P.from("leads_sistema").update({status:n,observacao_interna:m,motivo_desistencia_id:u&&h?h:null}).eq("id",a.id);if(f(!1),s){b({type:"error",message:s.message});return}b({type:"success",message:"Lead atualizado com sucesso!"}),setTimeout(()=>{w({id:a.id,status:n,observacao_interna:m,motivo_desistencia_id:u&&h?h:null})},800)};return e.jsxs(p.div,{className:"fixed inset-0 z-50 flex items-center justify-center p-4",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},children:[e.jsx("div",{className:"absolute inset-0 bg-black/70 backdrop-blur-sm",onClick:v}),e.jsxs(p.div,{className:"relative z-10 w-full max-w-lg bg-[#1E293B] border border-white/10 rounded-3xl p-6 shadow-2xl",initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:20},children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-2xl bg-gradient-to-br from-[#10B981] to-[#059669] flex items-center justify-center text-black font-black text-xl",children:a.nome?.charAt(0).toUpperCase()}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-bold text-white",children:a.nome}),e.jsx("p",{className:"text-xs text-gray-500 font-medium uppercase tracking-wider",children:"ðŸš€ Prospect LeadCapture Pro"})]})]}),e.jsx("button",{onClick:v,className:"w-8 h-8 rounded-full bg-white/5 hover:bg-white/10 flex items-center justify-center text-gray-400 transition-all",children:"âœ•"})]}),e.jsx("div",{className:"grid grid-cols-2 gap-3 mb-5",children:[{label:"E-mail",value:a.email,icon:"ðŸ“§"},{label:"WhatsApp",value:a.telefone,icon:"ðŸ“±"},{label:"Empresa",value:a.companhia||"â€”",icon:"ðŸ¢"},{label:"Cidade",value:a.cidade?`${a.cidade}${a.estado?" â€” "+a.estado:""}`:"â€”",icon:"ðŸ“"},{label:"Fonte",value:a.fonte||"â€”",icon:"ðŸ”—"},{label:"Captado em",value:O(a.created_at),icon:"ðŸ“…"}].map(({label:s,value:g,icon:A})=>e.jsxs("div",{className:"bg-white/5 rounded-xl p-3",children:[e.jsxs("p",{className:"text-[9px] font-black uppercase tracking-widest text-gray-500 mb-1",children:[A," ",s]}),e.jsx("p",{className:"text-sm text-white font-medium truncate",title:g,children:g})]},s))}),a.observacao&&e.jsxs("div",{className:"bg-blue-500/10 border border-blue-500/20 rounded-xl p-3 mb-4",children:[e.jsx("p",{className:"text-[9px] font-black uppercase tracking-widest text-blue-400 mb-1",children:"ðŸ“© Mensagem do Prospect (Original)"}),e.jsx("p",{className:"text-sm text-white leading-relaxed",children:a.observacao})]}),a.observacao_original&&!a.observacao&&e.jsxs("div",{className:"bg-white/5 rounded-xl p-3 mb-4",children:[e.jsx("p",{className:"text-[9px] font-black uppercase tracking-widest text-gray-500 mb-1",children:"ðŸ’¬ Mensagem"}),e.jsx("p",{className:"text-sm text-gray-300 leading-relaxed",children:a.observacao_original})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-[9px] font-black uppercase tracking-widest text-gray-500 mb-2",children:"Status"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:c.map(s=>e.jsxs("button",{onClick:()=>F(s.slug),className:`
                  px-3 py-1.5 rounded-xl text-xs font-bold border transition-all
                  ${n===s.slug?(B[s.slug]||"bg-white/10 text-white border-white/30")+" shadow-md":"bg-white/5 border-white/10 text-gray-500 hover:bg-white/10"}
                `,children:[L[s.slug]||"ðŸ”µ"," ",s.label]},s.slug))})]}),u&&j.length>0&&e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-[9px] font-black uppercase tracking-widest text-gray-500 mb-2",children:"âŒ Motivo de DesistÃªncia"}),e.jsxs("select",{value:h,onChange:s=>E(s.target.value),className:"w-full bg-white/5 border border-white/10 rounded-xl px-4 py-3 text-sm text-[#F8FAFC] focus:outline-none focus:border-[#10B981]/50 transition-all",children:[e.jsx("option",{value:"",children:"â€” Selecione o motivo â€”"}),j.map(s=>e.jsx("option",{value:s.id,children:s.nome},s.id))]})]}),e.jsxs("div",{className:"mb-5",children:[e.jsx("label",{className:"block text-[9px] font-black uppercase tracking-widest text-gray-500 mb-2",children:"ðŸ“ ObservaÃ§Ãµes Internas (CRM)"}),e.jsx("textarea",{value:m,onChange:s=>y(s.target.value),rows:3,placeholder:"Notas internas sobre este prospect...",className:"w-full bg-white/5 border border-white/10 rounded-xl px-4 py-3 text-sm text-[#F8FAFC] placeholder:text-gray-600 focus:outline-none focus:border-[#10B981]/50 resize-none transition-all"}),e.jsx("p",{className:"text-xs text-white/30 mt-1",children:"Nota: Essas observaÃ§Ãµes sÃ£o internas e nÃ£o sobrescrevem a mensagem original do prospect"})]}),i&&e.jsxs("div",{className:`mb-4 px-4 py-3 rounded-xl text-sm font-bold ${i.type==="success"?"bg-green-500/10 border border-green-500/30 text-green-400":"bg-red-500/10 border border-red-500/30 text-red-400"}`,children:[i.type==="success"?"âœ… ":"âŒ ",i.message]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:v,className:"flex-1 px-4 py-3 rounded-xl border border-white/10 text-gray-400 text-sm font-bold hover:bg-white/5 transition-all",children:"Cancelar"}),e.jsx("button",{onClick:N,disabled:x,className:"flex-1 px-4 py-3 rounded-xl bg-gradient-to-r from-[#10B981] to-[#059669] text-black font-black text-sm hover:opacity-90 disabled:opacity-50 transition-all",children:x?e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"w-4 h-4 border-2 border-black/30 border-t-black rounded-full animate-spin inline-block"}),"Salvando..."]}):"âœ… Salvar"})]})]})]})}function ce(){const{usuario:a}=V(),{alertModal:v,showAlert:w}=Y(),[c,j]=r.useState([]),[n,F]=r.useState([]),[h,E]=r.useState(!0),[m,y]=r.useState(""),[x,f]=r.useState(""),[i,b]=r.useState("todos"),[u,N]=r.useState(null),[s,g]=r.useState(1),[A,$]=r.useState(!1),[q,R]=r.useState([]),k=r.useRef(null),U=r.useCallback(t=>{f(t),k.current&&clearTimeout(k.current),k.current=setTimeout(()=>y(t),300)},[]);r.useEffect(()=>{a?.tenant_id&&M()},[a?.tenant_id]),r.useEffect(()=>{if(!a?.tenant_id)return;const t=a.tenant_id;P.from("motivos_desistencia").select("id, nome").eq("tenant_id",t).eq("ativo",!0).then(({data:o,error:l})=>{l?console.error("Erro ao buscar motivos_desistencia:",l):o&&R(o)})},[a?.tenant_id]),r.useEffect(()=>()=>{k.current&&clearTimeout(k.current)},[]),r.useEffect(()=>{let t=[...c];if(i!=="todos"&&(t=t.filter(o=>o.status===i)),m){const o=m.toLowerCase();t=t.filter(l=>l.nome?.toLowerCase().includes(o)||l.email?.toLowerCase().includes(o)||l.telefone?.includes(o)||l.companhia?.toLowerCase().includes(o))}F(t),g(1)},[c,m,i]);const M=async({silent:t=!1}={})=>{if(!a?.tenant_id)return;t||E(!0);const{data:o,error:l}=await P.from("leads_sistema").select("id, nome, email, telefone, companhia, cidade, estado, status, fonte, observacao, observacao_interna, observacao_original, motivo_desistencia_id, created_at").eq("tenant_id",a.tenant_id).order("created_at",{ascending:!1});!l&&o&&j(o),t||E(!1)},z=t=>{t&&j(o=>o.map(l=>l.id===t.id?{...l,...t}:l)),N(null),M({silent:!0})},H=async()=>{if(n.length===0){w({type:"warning",title:"AtenÃ§Ã£o",message:"Nenhum lead para exportar"});return}$(!0);try{const t=n.map(d=>({Nome:d.nome||"",Email:d.email||"",Telefone:d.telefone||"",Status:d.status||"novo",Origem:d.fonte||"Sistema","Data CriaÃ§Ã£o":d.created_at?new Date(d.created_at).toLocaleDateString("pt-BR"):"","Mensagem Prospect":d.observacao||"","ObservaÃ§Ãµes Internas":d.observacao_interna||""})),o=T.json_to_sheet(t),l=T.book_new();T.book_append_sheet(l,o,"Leads Sistema"),o["!cols"]=[{wch:25},{wch:30},{wch:15},{wch:15},{wch:20},{wch:12},{wch:40},{wch:40}];const I=`leads-sistema-${new Date().toISOString().split("T")[0]}.xlsx`;Q(l,I),w({type:"success",title:"Exportado!",message:`${n.length} leads exportados para ${I}`})}catch{w({type:"error",title:"Erro ao Exportar",message:"NÃ£o foi possÃ­vel exportar a planilha"})}finally{$(!1)}},S=Math.ceil(n.length/C),Z=n.slice((s-1)*C,s*C),W=(s-1)*C+1,G=Math.min(s*C,n.length),_={total:c.length,novo:c.filter(t=>t.status==="novo").length,negociacao:c.filter(t=>t.status==="negociacao").length,fechado:c.filter(t=>t.status==="fechado").length,hoje:c.filter(t=>{const o=new Date(t.created_at),l=new Date;return o.toDateString()===l.toDateString()}).length};return h?e.jsx(K,{}):e.jsxs("div",{className:"min-h-screen bg-[#0F172A] text-[#F8FAFC] pb-32",children:[e.jsx("div",{className:"px-4 lg:px-10 pt-6 lg:pt-10 mb-8",children:e.jsxs(p.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},transition:{duration:.5},children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("span",{className:"text-3xl",children:"ðŸš€"}),e.jsxs("h1",{className:"text-2xl lg:text-4xl font-light text-white",children:["Prospects ",e.jsx("span",{className:"text-[#10B981] font-bold",children:"LeadCapture Pro"})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-16 h-0.5 bg-[#10B981] rounded-full"}),e.jsx("p",{className:"text-[8px] lg:text-[9px] text-gray-600 font-black uppercase tracking-[0.3em]",children:"Interessados no produto Â· Desenvolvido por ZafalÃ£o Tech"})]})]})}),e.jsx("div",{className:"px-4 lg:px-10 mb-8",children:e.jsx("div",{className:"grid grid-cols-2 lg:grid-cols-5 gap-3",children:[{label:"Total",value:_.total,icon:"ðŸ“Š",color:"from-[#10B981] to-[#059669]",id:"todos"},{label:"Novos",value:_.novo,icon:"ðŸ†•",color:"from-blue-600 to-blue-400",id:"novo"},{label:"Negociando",value:_.negociacao,icon:"ðŸ¤",color:"from-orange-600 to-orange-400",id:"negociacao"},{label:"Fechados",value:_.fechado,icon:"âœ…",color:"from-green-600 to-green-400",id:"fechado"},{label:"Hoje",value:_.hoje,icon:"ðŸ“…",color:"from-purple-600 to-purple-400",id:"todos"}].map((t,o)=>e.jsxs(p.button,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:o*.08},whileHover:{scale:1.02},whileTap:{scale:.98},onClick:()=>b(t.id),className:`
                relative overflow-hidden rounded-2xl p-4 text-left transition-all
                ${i===t.id&&t.id!=="todos"?`bg-gradient-to-br ${t.color} shadow-lg`:"bg-[#1E293B] border border-white/5 hover:border-white/10"}
              `,children:[e.jsx("div",{className:"text-2xl mb-2",children:t.icon}),e.jsx("div",{className:`text-2xl font-black ${i===t.id&&t.id!=="todos","text-white"}`,children:t.value}),e.jsx("div",{className:`text-[9px] font-black uppercase tracking-wider mt-1 ${i===t.id&&t.id!=="todos"?"text-white/70":"text-gray-500"}`,children:t.label})]},t.label))})}),e.jsx("div",{className:"px-4 lg:px-10 mb-8",children:e.jsxs("div",{className:"flex flex-col lg:flex-row gap-3",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx("input",{type:"text",value:x,onChange:t=>U(t.target.value),placeholder:"ðŸ” Buscar por nome, e-mail, empresa ou telefone...",className:"w-full bg-[#1E293B] border border-white/5 rounded-2xl px-5 py-4 text-sm text-[#F8FAFC] placeholder:text-gray-600 focus:outline-none focus:border-[#10B981]/50 focus:ring-2 focus:ring-[#10B981]/20 transition-all"}),x&&e.jsx("button",{onClick:()=>{f(""),y("")},className:"absolute right-4 top-1/2 -translate-y-1/2 text-gray-500 hover:text-white",children:"âœ•"})]}),e.jsxs("div",{className:"flex gap-2 flex-wrap items-center",children:[[{slug:"todos",label:"Todos"},...D].map(t=>e.jsx("button",{onClick:()=>b(t.slug),className:`
                  px-4 py-2 rounded-xl text-xs font-bold border transition-all whitespace-nowrap
                  ${i===t.slug?t.slug==="todos"?"bg-[#10B981] text-black border-[#10B981]":B[t.slug]+" shadow-md":"bg-[#1E293B] border-white/5 text-gray-500 hover:bg-white/5"}
                `,children:t.slug==="todos"?"ðŸ“‹ Todos":`${L[t.slug]||"ðŸ”µ"} ${t.label}`},t.slug)),e.jsx("button",{onClick:H,disabled:n.length===0||A,className:"px-4 py-2 rounded-xl bg-green-700 hover:bg-green-600 text-white text-xs font-bold border border-green-600/50 transition-all whitespace-nowrap disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-1",children:A?e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"w-3.5 h-3.5 border-2 border-white/30 border-t-white rounded-full animate-spin inline-block"}),"Exportando..."]}):e.jsxs(e.Fragment,{children:["ðŸ“Š Excel (",n.length,")"]})})]})]})}),e.jsx("div",{className:"px-4 lg:px-10",children:n.length===0?e.jsxs(p.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},className:"text-center py-20",children:[e.jsx("div",{className:"text-6xl mb-4 opacity-30",children:"ðŸš€"}),e.jsx("p",{className:"text-xl text-gray-400 mb-2",children:x||i!=="todos"?"Nenhum prospect encontrado":"Nenhum prospect ainda"}),e.jsx("p",{className:"text-sm text-gray-600 mb-6",children:x||i!=="todos"?"Tente ajustar os filtros":"Os prospects chegam via /captacao e WhatsApp"}),(x||i!=="todos")&&e.jsx("button",{onClick:()=>{f(""),y(""),b("todos")},className:"px-6 py-3 bg-[#10B981] text-black font-bold rounded-xl hover:bg-[#059669] transition-all",children:"Limpar Filtros"})]}):e.jsxs("div",{className:"bg-[#1E293B] border border-white/5 rounded-3xl overflow-hidden",children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-white/5",children:[e.jsx("th",{className:"px-4 py-4 text-left text-xs font-black text-gray-500 uppercase tracking-wider",children:"Prospect"}),e.jsx("th",{className:"px-4 py-4 text-left text-xs font-black text-gray-500 uppercase tracking-wider hidden lg:table-cell",children:"Contato"}),e.jsx("th",{className:"px-4 py-4 text-left text-xs font-black text-gray-500 uppercase tracking-wider hidden xl:table-cell",children:"Empresa"}),e.jsx("th",{className:"px-4 py-4 text-left text-xs font-black text-gray-500 uppercase tracking-wider",children:"Status"}),e.jsx("th",{className:"px-4 py-4 text-left text-xs font-black text-gray-500 uppercase tracking-wider hidden lg:table-cell",children:"Captado"}),e.jsx("th",{className:"px-4 py-4 text-right text-xs font-black text-gray-500 uppercase tracking-wider",children:"AÃ§Ãµes"})]})}),e.jsx("tbody",{children:Z.map((t,o)=>e.jsxs(p.tr,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:Math.min(o*.03,.3)},className:"border-b border-white/5 hover:bg-white/5 transition-colors",children:[e.jsx("td",{className:"px-4 py-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-gradient-to-br from-[#10B981] to-[#059669] flex items-center justify-center text-black font-bold",children:t.nome?.charAt(0).toUpperCase()}),e.jsxs("div",{children:[e.jsx("div",{className:"font-bold text-white",children:t.nome}),e.jsx("div",{className:"text-xs text-gray-500",children:t.cidade?`${t.cidade}${t.estado?" â€” "+t.estado:""}`:"ðŸš€ LeadCapture Pro"})]})]})}),e.jsxs("td",{className:"px-4 py-4 hidden lg:table-cell",children:[e.jsx("div",{className:"text-sm text-gray-300",children:t.email||"â€”"}),e.jsx("div",{className:"text-xs text-gray-500",children:t.telefone||"â€”"})]}),e.jsxs("td",{className:"px-4 py-4 hidden xl:table-cell",children:[e.jsx("div",{className:"text-sm text-gray-300",children:t.companhia||"â€”"}),e.jsx("div",{className:"text-xs text-gray-500",children:t.fonte||"â€”"})]}),e.jsx("td",{className:"px-4 py-4",children:e.jsxs("span",{className:`
                          inline-flex items-center gap-1 px-3 py-1 rounded-full text-xs font-bold border
                          ${B[t.status]||B.novo}
                        `,children:[L[t.status]||"ðŸ†•"," ",t.status||"novo"]})}),e.jsx("td",{className:"px-4 py-4 hidden lg:table-cell",children:e.jsx("div",{className:"text-sm text-gray-400",children:O(t.created_at)})}),e.jsx("td",{className:"px-4 py-4 text-right",children:e.jsx(p.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:()=>N(t),className:"px-4 py-2 rounded-xl bg-white/5 border border-white/10 text-white text-xs font-bold hover:bg-white/10 transition-all",children:"Ver detalhes"})})]},t.id))})]})}),e.jsx("div",{className:"px-4 py-4 border-t border-white/5",children:e.jsxs("div",{className:"flex flex-col lg:flex-row items-center justify-between gap-4",children:[e.jsxs("p",{className:"text-xs text-gray-600",children:["Exibindo ",e.jsx("span",{className:"text-white font-bold",children:W})," a"," ",e.jsx("span",{className:"text-white font-bold",children:G})," de"," ",e.jsx("span",{className:"text-white font-bold",children:n.length})," prospects",n.length!==c.length&&e.jsxs("span",{className:"text-gray-700",children:[" (de ",c.length," total)"]})]}),S>1&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>g(t=>Math.max(1,t-1)),disabled:s===1,className:"px-4 py-2 rounded-xl bg-white/5 border border-white/10 text-white text-xs font-bold hover:bg-white/10 transition-all disabled:opacity-30 disabled:cursor-not-allowed",children:"â† Anterior"}),e.jsx("div",{className:"flex items-center gap-1",children:[...Array(S)].map((t,o)=>{const l=o+1;return l===1||l===S||l>=s-1&&l<=s+1?e.jsx("button",{onClick:()=>g(l),className:`
                                w-8 h-8 rounded-lg text-xs font-bold transition-all
                                ${s===l?"bg-[#10B981] text-black":"bg-white/5 text-gray-400 hover:bg-white/10"}
                              `,children:l},l):l===s-2||l===s+2?e.jsx("span",{className:"text-gray-600",children:"..."},l):null})}),e.jsx("button",{onClick:()=>g(t=>Math.min(S,t+1)),disabled:s===S,className:"px-4 py-2 rounded-xl bg-white/5 border border-white/10 text-white text-xs font-bold hover:bg-white/10 transition-all disabled:opacity-30 disabled:cursor-not-allowed",children:"PrÃ³xima â†’"})]}),e.jsx("p",{className:"text-[9px] text-gray-700 font-black uppercase tracking-widest",children:"LeadCapture Pro Â· ZafalÃ£o Tech"})]})})]})}),e.jsx(J,{children:u&&e.jsx(X,{prospect:u,onClose:()=>N(null),onSaved:z,statusOpts:D,motivosDesistencia:q},u.id)}),v]})}export{ce as default};
